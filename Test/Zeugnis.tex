% --------------------------------------------------------------
%  Simple LuaLaTeX template – “Zeugnis”
%  Reads data from   student_data.lua   (see sample next to this file)
%  and produces a 2‑page A4 report similar to the HTML version.
% --------------------------------------------------------------

% --- Preamble -------------------------------------------------
\input{SchoolReportTemplate_ZeugnisTemplate_Packages.tex}
\input{SchoolReportTemplate_ZeugnisTemplate_Commands.tex}

\renewcommand\cellalign{tl}  % top-left alignment inside every \makecell


% --- Lua helpers ----------------------------------------------
\begin{luacode*}
	-- Load student data table
	dofile("student_data.lua")
	
	-- Escape TeX‑special characters coming from Lua strings
	 function tex_escape(str)
	 return (str
		:gsub("([%%#$&{}_\\])", "\\%1")   -- escape % # $ & _ { } \
		:gsub("\n", "\\\\"))              -- newline → \\
  	 end
	
	-- Convenience for checkbox columns (1‑4)
	function checkbox(level, col)
	return (level == col) and "$\\boxtimes$" or "$\\Box$"
	end
\end{luacode*}

\newcommand{\headcol}[2]{\cellcolor{#1}\color{white}\bfseries #2}

% --- Document --------------------------------------------------
\begin{document}
	
	% ---------- Title page ----------------------------------------
	\include{Zeugnis_titlepage.tex}

	\newpage
	
	% ---------- Personal text -------------------------------------
	Lieber \directlua{tex.sprint(student.first_name)},\\
	\directlua{tex.sprint(student.personal_text)}
	\newpage
	\vspace{1em}
	
%	% ---------- Subjects & competences ----------------------------

%\begin{luacode*}
%	local gradeCmd = {
%		[1]  = "\\gradeOne",
%		[2]  = "\\gradeTwo",
%		[3]  = "\\gradeThree",
%		[4]  = "\\gradeFour",
%		ne   = "\\gradeNotGiven",
%		HJ2  = "\\gradeComesWithSecondHalfYear",
%		default = "\\gradeDefault"
%	}
%
%	local headerTemplate = [=[
%	\cellcolor{egelightblue}{\textit{\textbf{%s}}} &
%		\makecell[c]{\footnotesize{sehr~gut\\erfüllt}} &
%		\makecell[c]{\footnotesize{gut\\erfüllt}} &
%		\makecell[c]{\footnotesize{teilweise\\erfüllt}} &
%		\makecell[c]{\footnotesize{nicht\\erfüllt}}\\
%		]=]
%
%for _, subj in ipairs(student.subjects) do
%	tex.print("\\renewcommand{\\arraystretch}{1.5}")
%	tex.print("\\begin{xltabular}{\\linewidth}{|X|C{\\tableGradeWidth}|C{\\tableGradeWidth}|C{\\tableGradeWidth}|C{\\tableGradeWidth}|}")
%	tex.print("\\nobreakhline")
%	-- tex.print(string.format(headerTemplate, tex_escape(subj.name)))
%	tex.print("\\nobreakhline")
%	
%	-- ----------------------------------------------------------
%	-- 2. exactly one row per AREA  ➔ all competences in 1st cell
%	-- ----------------------------------------------------------
%    for _, area in ipairs(subj.areas) do
%		-- build the first (description) cell with makecell
%		local lines = { "\\textbf{" .. tex_escape(area.title) .. "}" }
%		for _, comp in ipairs(area.competences) do
%			table.insert(lines, tex_escape(comp.description))
%		end
%		local firstCell = "\\makecell[tl]{" .. table.concat(lines, "\\\\") .. "}"
%		
%		-- print the complete row
%		tex.print(firstCell .. " " .. (gradeCmd[area.grade] or "\\default"))
%	end
%	
%	tex.print("\\end{xltabular}")
%end
%\end{luacode*}

\begin{xltabular}{\linewidth}{|X|C{\tableGradeWidth}|C{\tableGradeWidth}|C{\tableGradeWidth}|C{\tableGradeWidth}|}
	\hline
	\cellcolor{egelightblue}{\textit{\textbf{Mathe}}} & \thead{\footnotesize sehr gut\\erfüllt} & \thead{\footnotesize gut\\erfüllt} & \thead{\footnotesize teilweise\\erfüllt} & \thead{\footnotesize nicht\\erfüllt} \\
	\hline
\end{xltabular}


%\begin{xltabular}{\textwidth}{|
%		>{\raggedright\arraybackslash\cellcolor{teal!70}\color{white}\bfseries}X
%		|Y|Y|Y|Y|}
%	\hline
%	Fach &
%	\theadcell{sehr gut\\erfüllt} &
%	\theadcell{gut\\erfüllt} &
%	\theadcell{teilweise\\erfüllt} &
%	\theadcell{nicht\\erfüllt} \\\hline%
%	%  …body of the table…
%	Deutsch      &   &   &   &   \\\hline%
%	Mathematik   &   &   &   &   \\\hline%
%\end{xltabular}



\include{Zeugnis_back.tex}

	
\end{document}